import{j as fe,d as S,af as pe,ag as he,r as v,k as U,ah as ge,ai as ye,b as l,O as oe,a5 as te,aj as we,K as be,ak as _e,al as Be,am as se,an as ae,ao as Ce,l as ke,ap as Ee,h as w,aq as ne,_ as z,o as f,c as _,w as b,f as R,g as $,F as I,q as N,e as q,a as n,t as C,B as A,a3 as H,y as le,L as ue,ar as $e,as as Le,E as Re,at as Ve,au as De,ae as Fe}from"./index-uhrHXBCW.js";import{F as M}from"./index-W7UqPlSb.js";import{D as ie}from"./index-BLqB_DeI.js";const[Ie,F]=fe("rate");function Ne(e,o,c,p){return e>=o?{status:"full",value:1}:e+.5>=o&&c&&!p?{status:"half",value:.5}:e+1>=o&&c&&p?{status:"half",value:Math.round((e-o+1)*1e10)/1e10}:{status:"void",value:0}}const qe={size:oe,icon:te("star"),color:String,count:we(5),gutter:oe,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:te("star-o"),allowHalf:Boolean,voidColor:String,touchable:be,iconPrefix:String,modelValue:_e(0),disabledColor:String};var Se=S({name:Ie,props:qe,emits:["change","update:modelValue"],setup(e,{emit:o}){const c=pe(),[p,y]=he(),u=v(),r=U(()=>e.readonly||e.disabled),h=U(()=>r.value||!e.touchable),B=U(()=>Array(+e.count).fill("").map((d,a)=>Ne(e.modelValue,a+1,e.allowHalf,e.readonly)));let s,g,i=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;const E=()=>{g=ae(u);const d=p.value.map(ae);s=[],d.forEach((a,m)=>{i=Math.min(a.top,i),t=Math.max(a.top,t),e.allowHalf?s.push({score:m+.5,left:a.left,top:a.top,height:a.height},{score:m+1,left:a.left+a.width/2,top:a.top,height:a.height}):s.push({score:m+1,left:a.left,top:a.top,height:a.height})})},k=(d,a)=>{for(let m=s.length-1;m>0;m--)if(a>=g.top&&a<=g.bottom){if(d>s[m].left&&a>=s[m].top&&a<=s[m].top+s[m].height)return s[m].score}else{const V=a<g.top?i:t;if(d>s[m].left&&s[m].top===V)return s[m].score}return e.allowHalf?.5:1},j=d=>{r.value||d===e.modelValue||(o("update:modelValue",d),o("change",d))},re=d=>{h.value||(c.start(d),E())},de=d=>{if(!h.value&&(c.move(d),c.isHorizontal()&&!c.isTap.value)){const{clientX:a,clientY:m}=d.touches[0];Be(d),j(k(a,m))}},ce=(d,a)=>{const{icon:m,size:V,color:O,count:X,gutter:G,voidIcon:Y,disabled:L,voidColor:K,allowHalf:J,iconPrefix:W,disabledColor:Z}=e,P=a+1,T=d.status==="full",D=d.status==="void",ve=J&&d.value>0&&d.value<1;let x;G&&P!==+X&&(x={paddingRight:Ce(G)});const me=ee=>{E();let Q=J?k(ee.clientX,ee.clientY):P;e.clearable&&c.isTap.value&&Q===e.modelValue&&(Q=0),j(Q)};return l("div",{key:a,ref:y(a),role:"radio",style:x,class:F("item"),tabindex:L?void 0:0,"aria-setsize":X,"aria-posinset":P,"aria-checked":!D,onClick:me},[l(se,{size:V,name:T?m:Y,class:F("icon",{disabled:L,full:T}),color:L?Z:T?O:K,classPrefix:W},null),ve&&l(se,{size:V,style:{width:d.value+"em"},name:D?Y:m,class:F("icon",["half",{disabled:L,full:!D}]),color:L?Z:D?K:O,classPrefix:W},null)])};return ge(()=>e.modelValue),ye("touchmove",de,{target:u}),()=>l("div",{ref:u,role:"radiogroup",class:F({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:re},[B.value.map(ce)])}});const Pe=ke(Se),Te=S({name:"QuestionAnswer",props:{course:{type:Object,required:!0}},setup(e){const o=v(!1),c=v(!1),p=v([]),y=v(!1),u=v(""),r=v(!1),h=v(""),B=v(null),s=async()=>{o.value=!0;try{const k=await Ee({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,p.value=[...k.records]}catch{w("加载失败")}finally{o.value=!1}};return{loading:o,finished:c,qaList:p,showReplyDialog:y,replyContent:u,showQuestionDialog:r,questionContent:h,onLoad:s,reply:k=>{B.value=k,y.value=!0},submitReply:async()=>{if(!u.value.trim()){w("回复内容不能为空");return}if(u.value.trim().length>200){w("回复内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"answer",content:u.value,pid:B.value}),w("回复成功"),y.value=!1,u.value="",s()}catch{w("回复失败")}},question:()=>{r.value=!0},submitQuestion:async()=>{if(!h.value.trim()){w("提问内容不能为空");return}if(h.value.trim().length>200){w("提问内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"question",content:h.value}),w("提问成功"),r.value=!1,h.value="",s()}catch{w("提问失败")}}}}}),Qe={class:"question-answer"},Ue={key:0,class:"mb-4"},ze={key:0,class:"text-center text-gray-500 py-4"},Ae={class:"line-clamp-3"},He={class:"text-gray-500"},Me={key:0,class:"answers"},je={class:"reply-user"},Oe={class:"reply-content line-clamp-2"};function Xe(e,o,c,p,y,u){const r=A,h=H,B=le,s=ue,g=M,i=ie;return f(),_("div",Qe,[e.course.hasStudy?(f(),_("div",Ue,[l(r,{type:"primary",onClick:o[0]||(o[0]=t=>e.question())},{default:b(()=>o[6]||(o[6]=[R("我要提问")])),_:1})])):$("",!0),l(s,{loading:e.loading,"onUpdate:loading":o[1]||(o[1]=t=>e.loading=t),finished:e.finished,onLoad:e.onLoad},{default:b(()=>[e.qaList.length?$("",!0):(f(),_("div",ze," 暂无内容 ")),(f(!0),_(I,null,N(e.qaList,t=>(f(),q(B,{key:t.id},{icon:b(()=>[l(h,{class:"mr-2",src:t.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:b(()=>[n("div",null,C(t.userName),1),n("div",Ae,C(t.content),1),n("div",He,C(t.createTime),1),t.answers&&t.answers.length?(f(),_("div",Me,[o[7]||(o[7]=n("h3",{class:"font-semibold"},"回答 /",-1)),(f(!0),_(I,null,N(t.answers,E=>(f(),_("div",{key:E.id,class:"reply-item text-sm"},[n("div",je,C(E.userName)+"：",1),n("div",Oe,C(E.content),1)]))),128))])):$("",!0)]),"right-icon":b(()=>[e.course.hasStudy?(f(),q(r,{key:0,type:"primary",size:"small",onClick:E=>e.reply(t.id)},{default:b(()=>o[8]||(o[8]=[R("回复")])),_:2},1032,["onClick"])):$("",!0)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),l(i,{show:e.showQuestionDialog,"onUpdate:show":o[3]||(o[3]=t=>e.showQuestionDialog=t),title:"提问","show-cancel-button":"",onConfirm:e.submitQuestion},{default:b(()=>[l(g,{modelValue:e.questionContent,"onUpdate:modelValue":o[2]||(o[2]=t=>e.questionContent=t),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"]),l(i,{show:e.showReplyDialog,"onUpdate:show":o[5]||(o[5]=t=>e.showReplyDialog=t),title:"回复","show-cancel-button":"",onConfirm:e.submitReply},{default:b(()=>[l(g,{modelValue:e.replyContent,"onUpdate:modelValue":o[4]||(o[4]=t=>e.replyContent=t),placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const wo=z(Te,[["render",Xe],["__scopeId","data-v-8a06478b"]]),Ge=S({name:"NoteList",props:{course:{type:Object,required:!0}},setup(e){const o=v(!1),c=v(!1),p=v([]),y=v(!1),u=v(""),r=async()=>{o.value=!0;try{const s=await $e({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,p.value=[...s.records]}catch{w("加载失败")}finally{o.value=!1}};return{loading:o,finished:c,noteList:p,showDialog:y,content:u,onLoad:r,question:()=>{y.value=!0},submitQuestion:async()=>{if(!u.value.trim()){w("笔记内容不能为空");return}if(u.value.trim().length>200){w("笔记内容不能超过200个字符");return}try{await Le({courseId:e.course.id,content:u.value}),w("提交成功"),y.value=!1,u.value="",r()}catch{w("提交失败")}}}}}),Ye={class:"question-answer"},Ke={key:0,class:"mb-4"},Je={key:0,class:"text-center text-gray-500 py-4"},We={class:"line-clamp-3"},Ze={class:"text-gray-500"};function xe(e,o,c,p,y,u){const r=A,h=H,B=le,s=ue,g=M,i=ie;return f(),_("div",Ye,[e.course.hasStudy?(f(),_("div",Ke,[l(r,{type:"primary",onClick:o[0]||(o[0]=t=>e.question())},{default:b(()=>o[4]||(o[4]=[R("添加笔记")])),_:1})])):$("",!0),l(s,{loading:e.loading,"onUpdate:loading":o[1]||(o[1]=t=>e.loading=t),finished:e.finished,onLoad:e.onLoad},{default:b(()=>[e.noteList.length?$("",!0):(f(),_("div",Je," 暂无内容 ")),(f(!0),_(I,null,N(e.noteList,t=>(f(),q(B,{key:t.id},{icon:b(()=>[l(h,{class:"mr-2",src:t.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:b(()=>[n("div",null,C(t.userName),1),n("div",We,C(t.content),1),n("div",Ze,C(t.createTime),1)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),l(i,{show:e.showDialog,"onUpdate:show":o[3]||(o[3]=t=>e.showDialog=t),title:"笔记","show-cancel-button":"",onConfirm:e.submitQuestion},{default:b(()=>[l(g,{modelValue:e.content,"onUpdate:modelValue":o[2]||(o[2]=t=>e.content=t),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const bo=z(Ge,[["render",xe],["__scopeId","data-v-a808f0cc"]]),eo=S({name:"ReviewList",props:{course:{type:Object,required:!0}},setup(e){const o=v(!1),c=v(0),p=v(0),y=v(!1),u=v(""),r=v([]),h=()=>{o.value=!0},B=()=>{if(!u.value||p.value===0){w("请填写内容并评分");return}De({courseId:e.course.id,score:p.value*2,content:u.value}).then(()=>{o.value=!1,p.value=0,w("评价提交成功")})},s=g=>g/2;return Re(async()=>{const g=await Ve({courseId:e.course.id,page:{current:1,size:-1}});r.value=g.page.records,c.value=g.score,y.value=g.userEvaluated}),{showPopup:o,score:p,content:u,reviews:r,totalScore:c,userEvaluated:y,showReviewPopup:h,submitReview:B,getHalf:s}}}),oo={class:"review-page"},to={class:"total-score bg-white p-4"},so={class:"mr-2"},ao={class:"review-popup"},no={class:"score-section mb-2"},lo={class:"content-section mb-2 flex"},uo={class:"review-list"},io={key:0,class:"text-center text-gray-500 py-4"},ro={class:"review-content"},co={class:"review-header"},vo={class:"name"},mo={class:"review-body"},fo={class:"review-footer"};function po(e,o,c,p,y,u){const r=Pe,h=A,B=M,s=Fe,g=H;return f(),_("div",oo,[n("div",to,[o[3]||(o[3]=n("span",null,"综合评分: ",-1)),n("span",so,C(e.totalScore),1),l(r,{"model-value":e.getHalf(e.totalScore),"allow-half":"",readonly:""},null,8,["model-value"])]),e.course.hasStudy&&!e.userEvaluated?(f(),q(h,{key:0,type:"primary",onClick:e.showReviewPopup},{default:b(()=>o[4]||(o[4]=[R("我要评价")])),_:1},8,["onClick"])):$("",!0),l(s,{show:e.showPopup,"onUpdate:show":o[2]||(o[2]=i=>e.showPopup=i),position:"bottom",style:{"background-color":"var(--van-gray-1)"}},{default:b(()=>[n("div",ao,[n("div",no,[o[5]||(o[5]=n("span",{class:"mr-4"},"分数",-1)),l(r,{modelValue:e.score,"onUpdate:modelValue":o[0]||(o[0]=i=>e.score=i),"allow-half":""},null,8,["modelValue"])]),n("div",lo,[o[6]||(o[6]=n("span",{class:"mr-4"},"内容",-1)),l(B,{modelValue:e.content,"onUpdate:modelValue":o[1]||(o[1]=i=>e.content=i),class:"flex-1",type:"textarea",rows:"3",autosize:"",clearable:"",maxlength:"200",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),l(h,{type:"primary",onClick:e.submitReview},{default:b(()=>o[7]||(o[7]=[R("提交")])),_:1},8,["onClick"])])]),_:1},8,["show"]),n("div",uo,[e.reviews.length?$("",!0):(f(),_("div",io," 暂无内容 ")),(f(!0),_(I,null,N(e.reviews,i=>(f(),_("div",{key:i.id,class:"review-item bg-white p-4"},[l(g,{src:i.userAvatar,class:"avatar",round:""},null,8,["src"]),n("div",ro,[n("div",co,[n("span",vo,C(i.userName),1),l(r,{"model-value":e.getHalf(i.score),"allow-half":"",readonly:""},null,8,["model-value"])]),n("div",mo,C(i.content),1),n("div",fo,C(i.createTime),1)])]))),128))])])}const _o=z(eo,[["render",po],["__scopeId","data-v-ea5f2341"]]);export{bo as N,wo as Q,_o as R};
