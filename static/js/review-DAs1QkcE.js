import{l as le,d as E,ag as pe,H as he,a5 as te,V as oe,ah as ge,j as ye,ai as we,aj as _e,r as v,k as B,ak as be,al as Ce,b as i,am as ke,an as se,ao as $e,ap as ae,aq as Le,h as y,ar as ne,_ as H,c as _,o as f,f as V,w,g as I,B as A,F as P,q as T,e as Q,y as ie,a as l,t as k,a3 as F,L as re,as as Ve,at as Re,G as Ie,au as Ne,av as qe,af as Se}from"./index-2WoK3mnG.js";import{F as M}from"./index-9NRCuRYO.js";import{s as Pe}from"./Dialog-Cne7LoH-.js";const ue=le(Pe),[Te,S]=ye("rate");function Qe(e,t,c,p){return e>=t?{status:"full",value:1}:e+.5>=t&&c&&!p?{status:"half",value:.5}:e+1>=t&&c&&p?{status:"half",value:Math.round((e-t+1)*1e10)/1e10}:{status:"void",value:0}}const Ee={size:oe,icon:te("star"),color:String,count:ge(5),gutter:oe,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:te("star-o"),allowHalf:Boolean,voidColor:String,touchable:he,iconPrefix:String,modelValue:pe(0),disabledColor:String};var De=E({name:Te,props:Ee,emits:["change","update:modelValue"],setup(e,{emit:t}){const c=we(),[p,g]=_e(),r=v(),u=B(()=>e.readonly||e.disabled),h=B(()=>u.value||!e.touchable),b=B(()=>Array(+e.count).fill("").map((d,n)=>Qe(e.modelValue,n+1,e.allowHalf,e.readonly)));let s,C,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;const L=()=>{C=ae(r);const d=p.value.map(ae);s=[],d.forEach((n,m)=>{a=Math.min(n.top,a),o=Math.max(n.top,o),e.allowHalf?s.push({score:m+.5,left:n.left,top:n.top,height:n.height},{score:m+1,left:n.left+n.width/2,top:n.top,height:n.height}):s.push({score:m+1,left:n.left,top:n.top,height:n.height})})},$=(d,n)=>{for(let m=s.length-1;m>0;m--)if(n>=C.top&&n<=C.bottom){if(d>s[m].left&&n>=s[m].top&&n<=s[m].top+s[m].height)return s[m].score}else{const N=n<C.top?a:o;if(d>s[m].left&&s[m].top===N)return s[m].score}return e.allowHalf?.5:1},j=d=>{u.value||d===e.modelValue||(t("update:modelValue",d),t("change",d))},de=d=>{h.value||(c.start(d),L())},ce=d=>{if(!h.value&&(c.move(d),c.isHorizontal()&&!c.isTap.value)){const{clientX:n,clientY:m}=d.touches[0];ke(d),j($(n,m))}},ve=(d,n)=>{const{icon:m,size:N,color:G,count:O,gutter:X,voidIcon:Y,disabled:R,voidColor:J,allowHalf:K,iconPrefix:W,disabledColor:Z}=e,D=n+1,U=d.status==="full",q=d.status==="void",me=K&&d.value>0&&d.value<1;let x;X&&D!==+O&&(x={paddingRight:$e(X)});const fe=ee=>{L();let z=K?$(ee.clientX,ee.clientY):D;e.clearable&&c.isTap.value&&z===e.modelValue&&(z=0),j(z)};return i("div",{key:n,ref:g(n),role:"radio",style:x,class:S("item"),tabindex:R?void 0:0,"aria-setsize":O,"aria-posinset":D,"aria-checked":!q,onClick:fe},[i(se,{size:N,name:U?m:Y,class:S("icon",{disabled:R,full:U}),color:R?Z:U?G:J,classPrefix:W},null),me&&i(se,{size:N,style:{width:d.value+"em"},name:q?Y:m,class:S("icon",["half",{disabled:R,full:!q}]),color:R?Z:q?J:G,classPrefix:W},null)])};return be(()=>e.modelValue),Ce("touchmove",ce,{target:r}),()=>i("div",{ref:r,role:"radiogroup",class:S({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:de},[b.value.map(ve)])}});const Ue=le(De),ze=E({name:"QuestionAnswer",props:{course:{type:Object,required:!0}},setup(e){const t=v(!1),c=v(!1),p=v([]),g=v(!1),r=v(""),u=v(!1),h=v(""),b=v(null),s=async()=>{t.value=!0;try{const $=await Le({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,p.value=[...$.records]}catch{y("加载失败")}finally{t.value=!1}};return{loading:t,finished:c,qaList:p,showReplyDialog:g,replyContent:r,showQuestionDialog:u,questionContent:h,onLoad:s,reply:$=>{b.value=$,g.value=!0},submitReply:async()=>{if(!r.value.trim()){y("回复内容不能为空");return}if(r.value.trim().length>200){y("回复内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"answer",content:r.value,pid:b.value}),y("回复成功"),g.value=!1,r.value="",s()}catch{y("回复失败")}},question:()=>{u.value=!0},submitQuestion:async()=>{if(!h.value.trim()){y("提问内容不能为空");return}if(h.value.trim().length>200){y("提问内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"question",content:h.value}),y("提问成功"),u.value=!1,h.value="",s()}catch{y("提问失败")}}}}}),Be={class:"question-answer"},He={key:0,class:"mb-4"},Ae={key:0,class:"text-center text-gray-500 py-4"},Fe={class:"line-clamp-3"},Me={class:"text-gray-500"},je={key:0,class:"answers"},Ge={class:"reply-user"},Oe={class:"reply-content line-clamp-2"};function Xe(e,t,c,p,g,r){const u=A,h=F,b=ie,s=re,C=M,a=ue;return f(),_("div",Be,[e.course.hasStudy?(f(),_("div",He,[i(u,{type:"primary",onClick:t[0]||(t[0]=o=>e.question())},{default:w(()=>[...t[6]||(t[6]=[I("我要提问",-1)])]),_:1})])):V("",!0),i(s,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=o=>e.loading=o),finished:e.finished,onLoad:e.onLoad},{default:w(()=>[e.qaList.length?V("",!0):(f(),_("div",Ae," 暂无内容 ")),(f(!0),_(P,null,T(e.qaList,o=>(f(),Q(b,{key:o.id},{icon:w(()=>[i(h,{class:"mr-2",src:o.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:w(()=>[l("div",null,k(o.userName),1),l("div",Fe,k(o.content),1),l("div",Me,k(o.createTime),1),o.answers&&o.answers.length?(f(),_("div",je,[t[7]||(t[7]=l("h3",{class:"font-semibold"},"回答 /",-1)),(f(!0),_(P,null,T(o.answers,L=>(f(),_("div",{key:L.id,class:"reply-item text-sm"},[l("div",Ge,k(L.userName)+"：",1),l("div",Oe,k(L.content),1)]))),128))])):V("",!0)]),"right-icon":w(()=>[e.course.hasStudy?(f(),Q(u,{key:0,type:"primary",size:"small",onClick:L=>e.reply(o.id)},{default:w(()=>[...t[8]||(t[8]=[I("回复",-1)])]),_:1},8,["onClick"])):V("",!0)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),i(a,{show:e.showQuestionDialog,"onUpdate:show":t[3]||(t[3]=o=>e.showQuestionDialog=o),title:"提问","show-cancel-button":"",onConfirm:e.submitQuestion},{default:w(()=>[i(C,{modelValue:e.questionContent,"onUpdate:modelValue":t[2]||(t[2]=o=>e.questionContent=o),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"]),i(a,{show:e.showReplyDialog,"onUpdate:show":t[5]||(t[5]=o=>e.showReplyDialog=o),title:"回复","show-cancel-button":"",onConfirm:e.submitReply},{default:w(()=>[i(C,{modelValue:e.replyContent,"onUpdate:modelValue":t[4]||(t[4]=o=>e.replyContent=o),placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const _t=H(ze,[["render",Xe],["__scopeId","data-v-8a06478b"]]),Ye=E({name:"NoteList",props:{course:{type:Object,required:!0}},setup(e){const t=v(!1),c=v(!1),p=v([]),g=v(!1),r=v(""),u=async()=>{t.value=!0;try{const s=await Ve({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,p.value=[...s.records]}catch{y("加载失败")}finally{t.value=!1}};return{loading:t,finished:c,noteList:p,showDialog:g,content:r,onLoad:u,question:()=>{g.value=!0},submitQuestion:async()=>{if(!r.value.trim()){y("笔记内容不能为空");return}if(r.value.trim().length>200){y("笔记内容不能超过200个字符");return}try{await Re({courseId:e.course.id,content:r.value}),y("提交成功"),g.value=!1,r.value="",u()}catch{y("提交失败")}}}}}),Je={class:"question-answer"},Ke={key:0,class:"mb-4"},We={key:0,class:"text-center text-gray-500 py-4"},Ze={class:"line-clamp-3"},xe={class:"text-gray-500"};function et(e,t,c,p,g,r){const u=A,h=F,b=ie,s=re,C=M,a=ue;return f(),_("div",Je,[e.course.hasStudy?(f(),_("div",Ke,[i(u,{type:"primary",onClick:t[0]||(t[0]=o=>e.question())},{default:w(()=>[...t[4]||(t[4]=[I("添加笔记",-1)])]),_:1})])):V("",!0),i(s,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=o=>e.loading=o),finished:e.finished,onLoad:e.onLoad},{default:w(()=>[e.noteList.length?V("",!0):(f(),_("div",We," 暂无内容 ")),(f(!0),_(P,null,T(e.noteList,o=>(f(),Q(b,{key:o.id},{icon:w(()=>[i(h,{class:"mr-2",src:o.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:w(()=>[l("div",null,k(o.userName),1),l("div",Ze,k(o.content),1),l("div",xe,k(o.createTime),1)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),i(a,{show:e.showDialog,"onUpdate:show":t[3]||(t[3]=o=>e.showDialog=o),title:"笔记","show-cancel-button":"",onConfirm:e.submitQuestion},{default:w(()=>[i(C,{modelValue:e.content,"onUpdate:modelValue":t[2]||(t[2]=o=>e.content=o),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const bt=H(Ye,[["render",et],["__scopeId","data-v-a808f0cc"]]),tt=E({name:"ReviewList",props:{course:{type:Object,required:!0}},setup(e){const t=v(!1),c=v(0),p=v(0),g=v(!1),r=v(""),u=v([]),h=()=>{t.value=!0},b=async()=>{const a=await Ne({courseId:e.course.id,page:{current:1,size:-1}});u.value=a.page.records,c.value=a.score,g.value=a.userEvaluated},s=()=>{if(!r.value||p.value===0){y("请填写内容并评分");return}qe({courseId:e.course.id,score:p.value*2,content:r.value}).then(()=>{t.value=!1,p.value=0,y("评价提交成功"),b()})},C=a=>a/2;return Ie(async()=>{b()}),{showPopup:t,score:p,content:r,reviews:u,totalScore:c,userEvaluated:g,showReviewPopup:h,submitReview:s,getHalf:C}}}),ot={class:"review-page"},st={class:"total-score bg-white p-4"},at={class:"mr-2"},nt={class:"review-popup"},lt={class:"score-section mb-2"},it={class:"content-section mb-2 flex"},rt={class:"flex justify-end"},ut={class:"review-list"},dt={key:0,class:"text-center text-gray-500 py-4"},ct={class:"review-content"},vt={class:"review-header"},mt={class:"name"},ft={class:"review-body"},pt={class:"review-footer"};function ht(e,t,c,p,g,r){const u=Ue,h=A,b=M,s=Se,C=F;return f(),_("div",ot,[l("div",st,[t[3]||(t[3]=l("span",null,"综合评分: ",-1)),l("span",at,k(e.totalScore),1),i(u,{"model-value":e.getHalf(e.totalScore),"allow-half":"",readonly:""},null,8,["model-value"])]),e.course.hasStudy&&!e.userEvaluated?(f(),Q(h,{key:0,type:"primary",onClick:e.showReviewPopup},{default:w(()=>[...t[4]||(t[4]=[I("我要评价",-1)])]),_:1},8,["onClick"])):V("",!0),i(s,{show:e.showPopup,"onUpdate:show":t[2]||(t[2]=a=>e.showPopup=a),position:"bottom",style:{"background-color":"var(--van-gray-1)"}},{default:w(()=>[l("div",nt,[l("div",lt,[t[5]||(t[5]=l("span",{class:"mr-4"},"分数",-1)),i(u,{modelValue:e.score,"onUpdate:modelValue":t[0]||(t[0]=a=>e.score=a),"allow-half":""},null,8,["modelValue"])]),l("div",it,[t[6]||(t[6]=l("span",{class:"mr-4"},"内容",-1)),i(b,{modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=a=>e.content=a),class:"flex-1",type:"textarea",rows:"3",autosize:"",clearable:"",maxlength:"200",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),l("div",rt,[i(h,{type:"primary",onClick:e.submitReview},{default:w(()=>[...t[7]||(t[7]=[I("提交",-1)])]),_:1},8,["onClick"])])])]),_:1},8,["show"]),l("div",ut,[e.reviews.length?V("",!0):(f(),_("div",dt," 暂无内容 ")),(f(!0),_(P,null,T(e.reviews,a=>(f(),_("div",{key:a.id,class:"review-item bg-white p-4"},[i(C,{src:a.userAvatar,class:"avatar",round:""},null,8,["src"]),l("div",ct,[l("div",vt,[l("span",mt,k(a.userName),1),i(u,{"model-value":e.getHalf(a.score),"allow-half":"",readonly:""},null,8,["model-value"])]),l("div",ft,k(a.content),1),l("div",pt,k(a.createTime),1)])]))),128))])])}const Ct=H(tt,[["render",ht],["__scopeId","data-v-3b2c18cd"]]);export{bt as N,_t as Q,Ct as R};
