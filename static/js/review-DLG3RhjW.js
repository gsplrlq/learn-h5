import{c as M,d as P,r as w,ac as Re,u as Se,t as H,b as n,w as K,P as pe,ad as De,ae as Pe,R as Le,v as A,a as Te,B as L,af as Ae,n as W,ag as Fe,ah as J,ai as Ve,A as Ie,aj as Ne,y as qe,W as ze,ak as we,al as ye,am as de,an as He,ao as Qe,ap as Ue,aq as Oe,ar as Me,as as Ke,at as je,au as Xe,av as Ye,aw as Ge,p as We,ax as fe,ay as me,az as Je,m as b,aA as ve,_ as Z,o as B,e as k,g as C,j as V,l as F,x as Q,D as U,h as O,f as g,k as E,a4 as x,H as be,N as Be,aB as Ze,aC as xe,L as et,aD as tt,aE as ot}from"./index-ADPyas5r.js";import{F as ee}from"./index-BphKZXg5.js";const[Ce,he]=M("action-bar"),_e=Symbol(Ce),nt={placeholder:Boolean,safeAreaInsetBottom:H};var at=P({name:Ce,props:nt,setup(e,{slots:t}){const s=w(),f=Re(s,he),{linkChildren:c}=Se(_e);c();const u=()=>{var d;return n("div",{ref:s,class:[he(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(d=t.default)==null?void 0:d.call(t)])};return()=>e.placeholder?f(u):u()}});const st=K(at),[lt,ut]=M("action-bar-button"),it=pe({},De,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var rt=P({name:lt,props:it,setup(e,{slots:t}){const s=Pe(),{parent:f,index:c}=Le(_e),u=A(()=>{if(f){const i=f.children[c.value-1];return!(i&&"isButton"in i)}}),d=A(()=>{if(f){const i=f.children[c.value+1];return!(i&&"isButton"in i)}});return Te({isButton:!0}),()=>{const{type:i,icon:y,text:l,color:p,loading:m,disabled:o}=e;return n(L,{class:ut([i,{last:d.value,first:u.value}]),size:"large",type:i,icon:y,color:p,loading:m,disabled:o,onClick:s},{default:()=>[t.default?t.default():l]})}}});const ge=K(rt),[ct,R,q]=M("dialog"),dt=pe({},Ae,{title:String,theme:String,width:W,message:[String,Function],callback:Function,allowHtml:Boolean,className:Fe,transition:J("van-dialog-bounce"),messageAlign:String,closeOnPopstate:H,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:H,closeOnClickOverlay:Boolean}),ft=[...Ve,"transition","closeOnPopstate"];var mt=P({name:ct,props:dt,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:t,slots:s}){const f=w(),c=Ie({confirm:!1,cancel:!1}),u=v=>t("update:show",v),d=v=>{var _;u(!1),(_=e.callback)==null||_.call(e,v)},i=v=>()=>{e.show&&(t(v),e.beforeClose?(c[v]=!0,Oe(e.beforeClose,{args:[v],done(){d(v),c[v]=!1},canceled(){c[v]=!1}})):d(v))},y=i("cancel"),l=i("confirm"),p=Ne(v=>{var _,r;if(v.target!==((r=(_=f.value)==null?void 0:_.popupRef)==null?void 0:r.value))return;({Enter:e.showConfirmButton?l:de,Escape:e.showCancelButton?y:de})[v.key](),t("keydown",v)},["enter","esc"]),m=()=>{const v=s.title?s.title():e.title;if(v)return n("div",{class:R("header",{isolated:!e.message&&!s.default})},[v])},o=v=>{const{message:_,allowHtml:r,messageAlign:a}=e,h=R("message",{"has-title":v,[a]:a}),D=He(_)?_():_;return r&&typeof D=="string"?n("div",{class:h,innerHTML:D},null):n("div",{class:h},[D])},S=()=>{if(s.default)return n("div",{class:R("content")},[s.default()]);const{title:v,message:_,allowHtml:r}=e;if(_){const a=!!(v||s.title);return n("div",{key:r?1:0,class:R("content",{isolated:!a})},[o(a)])}},$=()=>n("div",{class:[Ue,R("footer")]},[e.showCancelButton&&n(L,{size:"large",text:e.cancelButtonText||q("cancel"),class:R("cancel"),style:{color:e.cancelButtonColor},loading:c.cancel,disabled:e.cancelButtonDisabled,onClick:y},null),e.showConfirmButton&&n(L,{size:"large",text:e.confirmButtonText||q("confirm"),class:[R("confirm"),{[Qe]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:c.confirm,disabled:e.confirmButtonDisabled,onClick:l},null)]),I=()=>n(st,{class:R("footer")},{default:()=>[e.showCancelButton&&n(ge,{type:"warning",text:e.cancelButtonText||q("cancel"),class:R("cancel"),color:e.cancelButtonColor,loading:c.cancel,disabled:e.cancelButtonDisabled,onClick:y},null),e.showConfirmButton&&n(ge,{type:"danger",text:e.confirmButtonText||q("confirm"),class:R("confirm"),color:e.confirmButtonColor,loading:c.confirm,disabled:e.confirmButtonDisabled,onClick:l},null)]}),j=()=>s.footer?s.footer():e.theme==="round-button"?I():$();return()=>{const{width:v,title:_,theme:r,message:a,className:h}=e;return n(ye,qe({ref:f,role:"dialog",class:[R([r]),h],style:{width:we(v)},tabindex:0,"aria-labelledby":_||a,onKeydown:p,"onUpdate:show":u},ze(e,ft)),{default:()=>[m(),S(),j()]})}}});const ke=K(mt),[vt,z]=M("rate");function ht(e,t,s,f){return e>=t?{status:"full",value:1}:e+.5>=t&&s&&!f?{status:"half",value:.5}:e+1>=t&&s&&f?{status:"half",value:Math.round((e-t+1)*1e10)/1e10}:{status:"void",value:0}}const gt={size:W,icon:J("star"),color:String,count:Ye(5),gutter:W,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:J("star-o"),allowHalf:Boolean,voidColor:String,touchable:H,iconPrefix:String,modelValue:Ge(0),disabledColor:String};var pt=P({name:vt,props:gt,emits:["change","update:modelValue"],setup(e,{emit:t}){const s=Me(),[f,c]=Ke(),u=w(),d=A(()=>e.readonly||e.disabled),i=A(()=>d.value||!e.touchable),y=A(()=>Array(+e.count).fill("").map((r,a)=>ht(e.modelValue,a+1,e.allowHalf,e.readonly)));let l,p,m=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;const S=()=>{p=me(u);const r=f.value.map(me);l=[],r.forEach((a,h)=>{m=Math.min(a.top,m),o=Math.max(a.top,o),e.allowHalf?l.push({score:h+.5,left:a.left,top:a.top,height:a.height},{score:h+1,left:a.left+a.width/2,top:a.top,height:a.height}):l.push({score:h+1,left:a.left,top:a.top,height:a.height})})},$=(r,a)=>{for(let h=l.length-1;h>0;h--)if(a>=p.top&&a<=p.bottom){if(r>l[h].left&&a>=l[h].top&&a<=l[h].top+l[h].height)return l[h].score}else{const D=a<p.top?m:o;if(r>l[h].left&&l[h].top===D)return l[h].score}return e.allowHalf?.5:1},I=r=>{d.value||r===e.modelValue||(t("update:modelValue",r),t("change",r))},j=r=>{i.value||(s.start(r),S())},v=r=>{if(!i.value&&(s.move(r),s.isHorizontal()&&!s.isTap.value)){const{clientX:a,clientY:h}=r.touches[0];We(r),I($(a,h))}},_=(r,a)=>{const{icon:h,size:D,color:te,count:oe,gutter:ne,voidIcon:ae,disabled:T,voidColor:se,allowHalf:le,iconPrefix:ue,disabledColor:ie}=e,X=a+1,Y=r.status==="full",N=r.status==="void",Ee=le&&r.value>0&&r.value<1;let re;ne&&X!==+oe&&(re={paddingRight:we(ne)});const $e=ce=>{S();let G=le?$(ce.clientX,ce.clientY):X;e.clearable&&s.isTap.value&&G===e.modelValue&&(G=0),I(G)};return n("div",{key:a,ref:c(a),role:"radio",style:re,class:z("item"),tabindex:T?void 0:0,"aria-setsize":oe,"aria-posinset":X,"aria-checked":!N,onClick:$e},[n(fe,{size:D,name:Y?h:ae,class:z("icon",{disabled:T,full:Y}),color:T?ie:Y?te:se,classPrefix:ue},null),Ee&&n(fe,{size:D,style:{width:r.value+"em"},name:N?ae:h,class:z("icon",["half",{disabled:T,full:!N}]),color:T?ie:N?se:te,classPrefix:ue},null)])};return je(()=>e.modelValue),Xe("touchmove",v,{target:u}),()=>n("div",{ref:u,role:"radiogroup",class:z({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:j},[y.value.map(_)])}});const wt=K(pt),yt=P({name:"QuestionAnswer",props:{course:{type:Object,required:!0}},setup(e){const t=w(!1),s=w(!1),f=w([]),c=w(!1),u=w(""),d=w(!1),i=w(""),y=w(null),l=async()=>{t.value=!0;try{const $=await Je({courseId:e.course.id,page:{current:1,size:-1}});s.value=!0,f.value=[...$.records]}catch{b("加载失败")}finally{t.value=!1}};return{loading:t,finished:s,qaList:f,showReplyDialog:c,replyContent:u,showQuestionDialog:d,questionContent:i,onLoad:l,reply:$=>{y.value=$,c.value=!0},submitReply:async()=>{if(!u.value.trim()){b("回复内容不能为空");return}if(u.value.trim().length>200){b("回复内容不能超过200个字符");return}try{await ve({courseId:e.course.id,type:"answer",content:u.value,pid:y.value}),b("回复成功"),c.value=!1,u.value="",l()}catch{b("回复失败")}},question:()=>{d.value=!0},submitQuestion:async()=>{if(!i.value.trim()){b("提问内容不能为空");return}if(i.value.trim().length>200){b("提问内容不能超过200个字符");return}try{await ve({courseId:e.course.id,type:"question",content:i.value}),b("提问成功"),d.value=!1,i.value="",l()}catch{b("提问失败")}}}}}),bt={class:"question-answer"},Bt={key:0,class:"mb-4"},Ct={class:"line-clamp-3"},_t={class:"text-gray-500"},kt={key:0,class:"answers"},Et={class:"reply-user"},$t={class:"reply-content line-clamp-2"};function Rt(e,t,s,f,c,u){const d=L,i=x,y=be,l=Be,p=ee,m=ke;return B(),k("div",bt,[e.course.hasStudy?(B(),k("div",Bt,[n(d,{type:"primary",onClick:t[0]||(t[0]=o=>e.question())},{default:C(()=>t[6]||(t[6]=[V("我要提问")])),_:1})])):F("",!0),n(l,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=o=>e.loading=o),finished:e.finished,"finished-text":"没有更多了",onLoad:e.onLoad},{default:C(()=>[(B(!0),k(Q,null,U(e.qaList,o=>(B(),O(y,{key:o.id},{icon:C(()=>[n(i,{class:"mr-2",src:o.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:C(()=>[g("div",null,E(o.userName),1),g("div",Ct,E(o.content),1),g("div",_t,E(o.createTime),1),o.answers&&o.answers.length?(B(),k("div",kt,[t[7]||(t[7]=g("h3",{class:"font-semibold"},"回答 /",-1)),(B(!0),k(Q,null,U(o.answers,S=>(B(),k("div",{key:S.id,class:"reply-item text-sm"},[g("div",Et,E(S.userName)+"：",1),g("div",$t,E(S.content),1)]))),128))])):F("",!0)]),"right-icon":C(()=>[e.course.hasStudy?(B(),O(d,{key:0,type:"primary",size:"small",onClick:S=>e.reply(o.id)},{default:C(()=>t[8]||(t[8]=[V("回复")])),_:2},1032,["onClick"])):F("",!0)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),n(m,{show:e.showQuestionDialog,"onUpdate:show":t[3]||(t[3]=o=>e.showQuestionDialog=o),title:"提问","show-cancel-button":"",onConfirm:e.submitQuestion},{default:C(()=>[n(p,{modelValue:e.questionContent,"onUpdate:modelValue":t[2]||(t[2]=o=>e.questionContent=o),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"]),n(m,{show:e.showReplyDialog,"onUpdate:show":t[5]||(t[5]=o=>e.showReplyDialog=o),title:"回复","show-cancel-button":"",onConfirm:e.submitReply},{default:C(()=>[n(p,{modelValue:e.replyContent,"onUpdate:modelValue":t[4]||(t[4]=o=>e.replyContent=o),placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const Wt=Z(yt,[["render",Rt],["__scopeId","data-v-65ba8b09"]]),St=P({name:"NoteList",props:{course:{type:Object,required:!0}},setup(e){const t=w(!1),s=w(!1),f=w([]),c=w(!1),u=w(""),d=async()=>{t.value=!0;try{const l=await Ze({courseId:e.course.id,page:{current:1,size:-1}});s.value=!0,f.value=[...l.records]}catch{b("加载失败")}finally{t.value=!1}};return{loading:t,finished:s,noteList:f,showDialog:c,content:u,onLoad:d,question:()=>{c.value=!0},submitQuestion:async()=>{if(!u.value.trim()){b("笔记内容不能为空");return}if(u.value.trim().length>200){b("笔记内容不能超过200个字符");return}try{await xe({courseId:e.course.id,content:u.value}),b("提交成功"),c.value=!1,u.value="",d()}catch{b("提交失败")}}}}}),Dt={class:"question-answer"},Pt={key:0,class:"mb-4"},Lt={class:"line-clamp-3"},Tt={class:"text-gray-500"};function At(e,t,s,f,c,u){const d=L,i=x,y=be,l=Be,p=ee,m=ke;return B(),k("div",Dt,[e.course.hasStudy?(B(),k("div",Pt,[n(d,{type:"primary",onClick:t[0]||(t[0]=o=>e.question())},{default:C(()=>t[4]||(t[4]=[V("添加笔记")])),_:1})])):F("",!0),n(l,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=o=>e.loading=o),finished:e.finished,"finished-text":"没有更多了",onLoad:e.onLoad},{default:C(()=>[(B(!0),k(Q,null,U(e.noteList,o=>(B(),O(y,{key:o.id},{icon:C(()=>[n(i,{class:"mr-2",src:o.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:C(()=>[g("div",null,E(o.userName),1),g("div",Lt,E(o.content),1),g("div",Tt,E(o.createTime),1)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),n(m,{show:e.showDialog,"onUpdate:show":t[3]||(t[3]=o=>e.showDialog=o),title:"笔记","show-cancel-button":"",onConfirm:e.submitQuestion},{default:C(()=>[n(p,{modelValue:e.content,"onUpdate:modelValue":t[2]||(t[2]=o=>e.content=o),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const Jt=Z(St,[["render",At],["__scopeId","data-v-b7e9bd70"]]),Ft=P({name:"ReviewList",props:{course:{type:Object,required:!0}},setup(e){const t=w(!1),s=w(0),f=w(0),c=w(!1),u=w(""),d=w([]),i=()=>{t.value=!0},y=()=>{if(!u.value||f.value===0){b("请填写内容并评分");return}ot({courseId:e.course.id,score:f.value*2,content:u.value}).then(()=>{t.value=!1,f.value=0,b("评价提交成功")})},l=p=>p/2;return et(async()=>{const p=await tt({courseId:e.course.id,page:{current:1,size:-1}});d.value=p.page.records,s.value=p.score,c.value=p.userEvaluated}),{showPopup:t,score:f,content:u,reviews:d,totalScore:s,userEvaluated:c,showReviewPopup:i,submitReview:y,getHalf:l}}}),Vt={class:"review-page"},It={class:"total-score bg-white p-4"},Nt={class:"mr-2"},qt={class:"review-popup"},zt={class:"score-section mb-2"},Ht={class:"content-section mb-2 flex"},Qt={class:"review-list"},Ut={class:"review-content"},Ot={class:"review-header"},Mt={class:"name"},Kt={class:"review-body"},jt={class:"review-footer"};function Xt(e,t,s,f,c,u){const d=wt,i=L,y=ee,l=ye,p=x;return B(),k("div",Vt,[g("div",It,[t[3]||(t[3]=g("span",null,"综合评分: ",-1)),g("span",Nt,E(e.totalScore),1),n(d,{"model-value":e.getHalf(e.totalScore),"allow-half":"",readonly:""},null,8,["model-value"])]),e.course.hasStudy&&!e.userEvaluated?(B(),O(i,{key:0,type:"primary",onClick:e.showReviewPopup},{default:C(()=>t[4]||(t[4]=[V("我要评价")])),_:1},8,["onClick"])):F("",!0),n(l,{show:e.showPopup,"onUpdate:show":t[2]||(t[2]=m=>e.showPopup=m),position:"bottom",style:{"background-color":"var(--van-gray-1)"}},{default:C(()=>[g("div",qt,[g("div",zt,[t[5]||(t[5]=g("span",{class:"mr-4"},"分数",-1)),n(d,{modelValue:e.score,"onUpdate:modelValue":t[0]||(t[0]=m=>e.score=m),"allow-half":""},null,8,["modelValue"])]),g("div",Ht,[t[6]||(t[6]=g("span",{class:"mr-4"},"内容",-1)),n(y,{modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=m=>e.content=m),class:"flex-1",type:"textarea",rows:"3",autosize:"",clearable:"",maxlength:"200",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),n(i,{type:"primary",onClick:e.submitReview},{default:C(()=>t[7]||(t[7]=[V("提交")])),_:1},8,["onClick"])])]),_:1},8,["show"]),g("div",Qt,[(B(!0),k(Q,null,U(e.reviews,m=>(B(),k("div",{key:m.id,class:"review-item bg-white p-4"},[n(p,{src:m.userAvatar,class:"avatar",round:""},null,8,["src"]),g("div",Ut,[g("div",Ot,[g("span",Mt,E(m.userName),1),n(d,{"model-value":e.getHalf(m.score),"allow-half":"",readonly:""},null,8,["model-value"])]),g("div",Kt,E(m.content),1),g("div",jt,E(m.createTime),1)])]))),128))])])}const Zt=Z(Ft,[["render",Xt],["__scopeId","data-v-e11753dd"]]);export{ge as A,Jt as N,Wt as Q,Zt as R,st as a};
