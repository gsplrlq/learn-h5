import{j as fe,d as S,ag as pe,ah as he,r as v,k as Q,ai as ge,aj as we,b as l,O as oe,a5 as te,ak as ye,K as be,al as _e,am as Ce,an as se,ao as ae,ap as Be,l as Ee,aq as ke,h as w,ar as ne,_ as U,o as y,c as C,w as b,f as V,g as R,F as I,q as N,e as q,a as n,t as B,B as z,a3 as H,y as le,L as ue,as as $e,at as Re,E as Ve,au as Le,av as De,af as Fe}from"./index-zMCUR-Ws.js";import{F as M}from"./index-Dnba_K_7.js";import{D as ie}from"./index-TEgZZ0bb.js";const[Ie,F]=fe("rate");function Ne(e,o,c,f){return e>=o?{status:"full",value:1}:e+.5>=o&&c&&!f?{status:"half",value:.5}:e+1>=o&&c&&f?{status:"half",value:Math.round((e-o+1)*1e10)/1e10}:{status:"void",value:0}}const qe={size:oe,icon:te("star"),color:String,count:ye(5),gutter:oe,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:te("star-o"),allowHalf:Boolean,voidColor:String,touchable:be,iconPrefix:String,modelValue:_e(0),disabledColor:String};var Se=S({name:Ie,props:qe,emits:["change","update:modelValue"],setup(e,{emit:o}){const c=pe(),[f,g]=he(),u=v(),r=Q(()=>e.readonly||e.disabled),p=Q(()=>r.value||!e.touchable),_=Q(()=>Array(+e.count).fill("").map((d,a)=>Ne(e.modelValue,a+1,e.allowHalf,e.readonly)));let s,h,i=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;const k=()=>{h=ae(u);const d=f.value.map(ae);s=[],d.forEach((a,m)=>{i=Math.min(a.top,i),t=Math.max(a.top,t),e.allowHalf?s.push({score:m+.5,left:a.left,top:a.top,height:a.height},{score:m+1,left:a.left+a.width/2,top:a.top,height:a.height}):s.push({score:m+1,left:a.left,top:a.top,height:a.height})})},E=(d,a)=>{for(let m=s.length-1;m>0;m--)if(a>=h.top&&a<=h.bottom){if(d>s[m].left&&a>=s[m].top&&a<=s[m].top+s[m].height)return s[m].score}else{const L=a<h.top?i:t;if(d>s[m].left&&s[m].top===L)return s[m].score}return e.allowHalf?.5:1},j=d=>{r.value||d===e.modelValue||(o("update:modelValue",d),o("change",d))},re=d=>{p.value||(c.start(d),k())},de=d=>{if(!p.value&&(c.move(d),c.isHorizontal()&&!c.isTap.value)){const{clientX:a,clientY:m}=d.touches[0];Ce(d),j(E(a,m))}},ce=(d,a)=>{const{icon:m,size:L,color:O,count:X,gutter:G,voidIcon:Y,disabled:$,voidColor:K,allowHalf:J,iconPrefix:W,disabledColor:Z}=e,P=a+1,T=d.status==="full",D=d.status==="void",ve=J&&d.value>0&&d.value<1;let x;G&&P!==+X&&(x={paddingRight:Be(G)});const me=ee=>{k();let A=J?E(ee.clientX,ee.clientY):P;e.clearable&&c.isTap.value&&A===e.modelValue&&(A=0),j(A)};return l("div",{key:a,ref:g(a),role:"radio",style:x,class:F("item"),tabindex:$?void 0:0,"aria-setsize":X,"aria-posinset":P,"aria-checked":!D,onClick:me},[l(se,{size:L,name:T?m:Y,class:F("icon",{disabled:$,full:T}),color:$?Z:T?O:K,classPrefix:W},null),ve&&l(se,{size:L,style:{width:d.value+"em"},name:D?Y:m,class:F("icon",["half",{disabled:$,full:!D}]),color:$?Z:D?K:O,classPrefix:W},null)])};return ge(()=>e.modelValue),we("touchmove",de,{target:u}),()=>l("div",{ref:u,role:"radiogroup",class:F({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:re},[_.value.map(ce)])}});const Pe=Ee(Se),Te=S({name:"QuestionAnswer",props:{course:{type:Object,required:!0}},setup(e){const o=v(!1),c=v(!1),f=v([]),g=v(!1),u=v(""),r=v(!1),p=v(""),_=v(null),s=async()=>{o.value=!0;try{const E=await ke({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,f.value=[...E.records]}catch{w("加载失败")}finally{o.value=!1}};return{loading:o,finished:c,qaList:f,showReplyDialog:g,replyContent:u,showQuestionDialog:r,questionContent:p,onLoad:s,reply:E=>{_.value=E,g.value=!0},submitReply:async()=>{if(!u.value.trim()){w("回复内容不能为空");return}if(u.value.trim().length>200){w("回复内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"answer",content:u.value,pid:_.value}),w("回复成功"),g.value=!1,u.value="",s()}catch{w("回复失败")}},question:()=>{r.value=!0},submitQuestion:async()=>{if(!p.value.trim()){w("提问内容不能为空");return}if(p.value.trim().length>200){w("提问内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"question",content:p.value}),w("提问成功"),r.value=!1,p.value="",s()}catch{w("提问失败")}}}}}),Ae={class:"question-answer"},Qe={key:0,class:"mb-4"},Ue={class:"line-clamp-3"},ze={class:"text-gray-500"},He={key:0,class:"answers"},Me={class:"reply-user"},je={class:"reply-content line-clamp-2"};function Oe(e,o,c,f,g,u){const r=z,p=H,_=le,s=ue,h=M,i=ie;return y(),C("div",Ae,[e.course.hasStudy?(y(),C("div",Qe,[l(r,{type:"primary",onClick:o[0]||(o[0]=t=>e.question())},{default:b(()=>o[6]||(o[6]=[V("我要提问")])),_:1})])):R("",!0),l(s,{loading:e.loading,"onUpdate:loading":o[1]||(o[1]=t=>e.loading=t),finished:e.finished,"finished-text":"没有更多了",onLoad:e.onLoad},{default:b(()=>[(y(!0),C(I,null,N(e.qaList,t=>(y(),q(_,{key:t.id},{icon:b(()=>[l(p,{class:"mr-2",src:t.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:b(()=>[n("div",null,B(t.userName),1),n("div",Ue,B(t.content),1),n("div",ze,B(t.createTime),1),t.answers&&t.answers.length?(y(),C("div",He,[o[7]||(o[7]=n("h3",{class:"font-semibold"},"回答 /",-1)),(y(!0),C(I,null,N(t.answers,k=>(y(),C("div",{key:k.id,class:"reply-item text-sm"},[n("div",Me,B(k.userName)+"：",1),n("div",je,B(k.content),1)]))),128))])):R("",!0)]),"right-icon":b(()=>[e.course.hasStudy?(y(),q(r,{key:0,type:"primary",size:"small",onClick:k=>e.reply(t.id)},{default:b(()=>o[8]||(o[8]=[V("回复")])),_:2},1032,["onClick"])):R("",!0)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),l(i,{show:e.showQuestionDialog,"onUpdate:show":o[3]||(o[3]=t=>e.showQuestionDialog=t),title:"提问","show-cancel-button":"",onConfirm:e.submitQuestion},{default:b(()=>[l(h,{modelValue:e.questionContent,"onUpdate:modelValue":o[2]||(o[2]=t=>e.questionContent=t),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"]),l(i,{show:e.showReplyDialog,"onUpdate:show":o[5]||(o[5]=t=>e.showReplyDialog=t),title:"回复","show-cancel-button":"",onConfirm:e.submitReply},{default:b(()=>[l(h,{modelValue:e.replyContent,"onUpdate:modelValue":o[4]||(o[4]=t=>e.replyContent=t),placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const ho=U(Te,[["render",Oe],["__scopeId","data-v-65ba8b09"]]),Xe=S({name:"NoteList",props:{course:{type:Object,required:!0}},setup(e){const o=v(!1),c=v(!1),f=v([]),g=v(!1),u=v(""),r=async()=>{o.value=!0;try{const s=await $e({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,f.value=[...s.records]}catch{w("加载失败")}finally{o.value=!1}};return{loading:o,finished:c,noteList:f,showDialog:g,content:u,onLoad:r,question:()=>{g.value=!0},submitQuestion:async()=>{if(!u.value.trim()){w("笔记内容不能为空");return}if(u.value.trim().length>200){w("笔记内容不能超过200个字符");return}try{await Re({courseId:e.course.id,content:u.value}),w("提交成功"),g.value=!1,u.value="",r()}catch{w("提交失败")}}}}}),Ge={class:"question-answer"},Ye={key:0,class:"mb-4"},Ke={class:"line-clamp-3"},Je={class:"text-gray-500"};function We(e,o,c,f,g,u){const r=z,p=H,_=le,s=ue,h=M,i=ie;return y(),C("div",Ge,[e.course.hasStudy?(y(),C("div",Ye,[l(r,{type:"primary",onClick:o[0]||(o[0]=t=>e.question())},{default:b(()=>o[4]||(o[4]=[V("添加笔记")])),_:1})])):R("",!0),l(s,{loading:e.loading,"onUpdate:loading":o[1]||(o[1]=t=>e.loading=t),finished:e.finished,"finished-text":"没有更多了",onLoad:e.onLoad},{default:b(()=>[(y(!0),C(I,null,N(e.noteList,t=>(y(),q(_,{key:t.id},{icon:b(()=>[l(p,{class:"mr-2",src:t.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:b(()=>[n("div",null,B(t.userName),1),n("div",Ke,B(t.content),1),n("div",Je,B(t.createTime),1)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),l(i,{show:e.showDialog,"onUpdate:show":o[3]||(o[3]=t=>e.showDialog=t),title:"笔记","show-cancel-button":"",onConfirm:e.submitQuestion},{default:b(()=>[l(h,{modelValue:e.content,"onUpdate:modelValue":o[2]||(o[2]=t=>e.content=t),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const go=U(Xe,[["render",We],["__scopeId","data-v-b7e9bd70"]]),Ze=S({name:"ReviewList",props:{course:{type:Object,required:!0}},setup(e){const o=v(!1),c=v(0),f=v(0),g=v(!1),u=v(""),r=v([]),p=()=>{o.value=!0},_=()=>{if(!u.value||f.value===0){w("请填写内容并评分");return}De({courseId:e.course.id,score:f.value*2,content:u.value}).then(()=>{o.value=!1,f.value=0,w("评价提交成功")})},s=h=>h/2;return Ve(async()=>{const h=await Le({courseId:e.course.id,page:{current:1,size:-1}});r.value=h.page.records,c.value=h.score,g.value=h.userEvaluated}),{showPopup:o,score:f,content:u,reviews:r,totalScore:c,userEvaluated:g,showReviewPopup:p,submitReview:_,getHalf:s}}}),xe={class:"review-page"},eo={class:"total-score bg-white p-4"},oo={class:"mr-2"},to={class:"review-popup"},so={class:"score-section mb-2"},ao={class:"content-section mb-2 flex"},no={class:"review-list"},lo={class:"review-content"},uo={class:"review-header"},io={class:"name"},ro={class:"review-body"},co={class:"review-footer"};function vo(e,o,c,f,g,u){const r=Pe,p=z,_=M,s=Fe,h=H;return y(),C("div",xe,[n("div",eo,[o[3]||(o[3]=n("span",null,"综合评分: ",-1)),n("span",oo,B(e.totalScore),1),l(r,{"model-value":e.getHalf(e.totalScore),"allow-half":"",readonly:""},null,8,["model-value"])]),e.course.hasStudy&&!e.userEvaluated?(y(),q(p,{key:0,type:"primary",onClick:e.showReviewPopup},{default:b(()=>o[4]||(o[4]=[V("我要评价")])),_:1},8,["onClick"])):R("",!0),l(s,{show:e.showPopup,"onUpdate:show":o[2]||(o[2]=i=>e.showPopup=i),position:"bottom",style:{"background-color":"var(--van-gray-1)"}},{default:b(()=>[n("div",to,[n("div",so,[o[5]||(o[5]=n("span",{class:"mr-4"},"分数",-1)),l(r,{modelValue:e.score,"onUpdate:modelValue":o[0]||(o[0]=i=>e.score=i),"allow-half":""},null,8,["modelValue"])]),n("div",ao,[o[6]||(o[6]=n("span",{class:"mr-4"},"内容",-1)),l(_,{modelValue:e.content,"onUpdate:modelValue":o[1]||(o[1]=i=>e.content=i),class:"flex-1",type:"textarea",rows:"3",autosize:"",clearable:"",maxlength:"200",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),l(p,{type:"primary",onClick:e.submitReview},{default:b(()=>o[7]||(o[7]=[V("提交")])),_:1},8,["onClick"])])]),_:1},8,["show"]),n("div",no,[(y(!0),C(I,null,N(e.reviews,i=>(y(),C("div",{key:i.id,class:"review-item bg-white p-4"},[l(h,{src:i.userAvatar,class:"avatar",round:""},null,8,["src"]),n("div",lo,[n("div",uo,[n("span",io,B(i.userName),1),l(r,{"model-value":e.getHalf(i.score),"allow-half":"",readonly:""},null,8,["model-value"])]),n("div",ro,B(i.content),1),n("div",co,B(i.createTime),1)])]))),128))])])}const wo=U(Ze,[["render",vo],["__scopeId","data-v-e11753dd"]]);export{go as N,ho as Q,wo as R};
