import{M as T,aQ as $,aR as P,aS as R,b as s,m as U,d as A,Z as S,G as N,r as D,E as j,aT as G,aU as I,aV as x,h as W,_ as M,c as r,a as f,t as m,F as c,w as d,aW as z,B as H,o,q as v,e as L,f as F,y as Q}from"./index-GNkAeWHx.js";import{C as Z,a as q}from"./index-jZPG-xs8.js";import{R as J,a as K}from"./index-D7mvOXQs.js";import{s as X}from"./index-C-EtKBxz.js";import{F as Y}from"./index-CX6MX_xf.js";import"./index-BQqwwR-8.js";let O;const ee={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let ae=T({},ee);function te(){({instance:O}=P({setup(){const{state:p,toggle:u}=R();return()=>s(X,U(p,{"onUpdate:show":u}),null)}}))}function E(e){return $?new Promise((p,u)=>{O||te(),O.open(T({},ae,e,{callback:l=>{(l==="confirm"?p:u)(l)}}))}):Promise.resolve(void 0)}const oe=e=>E(T({showCancelButton:!0},e)),le=A({name:"Exam",setup(){const e=S(),p=N(),u=D({}),l=D({}),h=D(0);let g=null;const i=D(null),_=async()=>{try{const t=await I(e.params.id);t.multipleChoicesList.forEach(n=>{l.value[n.id]=[]}),u.value=t,u.value.duration>0&&(h.value=u.value.duration*60,y())}catch{u.value={}}},y=()=>{g=window.setTimeout(()=>{h.value-=1,h.value===0?(B(),clearTimeout(g)):y()},1e3)},B=async()=>{const t=Object.keys(l.value).map(a=>({questionId:a,userOptions:typeof l.value[a]=="string"?[l.value[a]]:l.value[a]})),n={examId:u.value.id,trainingPackageId:e.query.trainingPackageId,questionReqList:t};try{const a=await x(n);E({message:"考试时间已结束, 请退出本次考试。（并自动交卷）"}).then(()=>{i.value=a})}catch(a){console.error(a)}},b=()=>{oe({title:"提示",message:"确定提交本次考试，无法撤回，是否继续？"}).then(async()=>{const t=Object.keys(l.value).map(a=>({questionId:a,userOptions:typeof l.value[a]=="string"?[l.value[a]]:l.value[a]})),n={examId:u.value.id,trainingPackageId:e.query.trainingPackageId,questionReqList:t};try{const a=await x(n);i.value=a,W("提交成功!"),clearTimeout(g)}catch(a){console.error(a)}})},w=()=>{p.go(-1)},k=()=>{p.replace({path:`/exam/detail/${i.value.id}`})};return j(()=>{_()}),G(()=>{clearTimeout(g)}),{examData:u,form:l,durationTime:h,result:i,submit:b,exit:w,toDetail:k}}}),ne={class:"exam"},se={class:"name"},ue={class:"time"},re={class:"scores"},ie={class:"flex"},ce={class:"mr-4"};function me(e,p,u,l,h,g){const i=Q,_=J,y=K,B=Z,b=q,w=Y,k=H;return o(),r("div",ne,[f("div",se,m(e.examData.name),1),f("div",ue,m(e.examData.duration)+"分钟",1),e.result?(o(),r(c,{key:1},[f("div",re,m(e.result.scores),1),f("div",{class:z(["result",e.result.examResult])},m(e.result.examResult==="qualified"?"合格":"不合格"),3),f("div",ie,[f("div",ce,[s(k,{type:"primary",text:"查看考试详情",onClick:e.toDetail},null,8,["onClick"])]),s(k,{type:"danger",text:"退出考试",onClick:e.exit},null,8,["onClick"])])],64)):(o(),r(c,{key:0},[s(w,{class:"list","label-position":"top",model:e.form},{default:d(()=>[(o(!0),r(c,null,v(e.examData.singleChoiceList,(t,n)=>(o(),r(c,{key:n},[s(i,{title:`(单选) ${n+1}: ${t.content}`},null,8,["title"]),s(i,null,{default:d(()=>[(o(!0),r(c,null,v(t.questionOptions,(a,C)=>(o(),L(y,{key:C,modelValue:e.form[t.id],"onUpdate:modelValue":V=>e.form[t.id]=V,class:"mb-2"},{default:d(()=>[s(_,{name:a.key},{default:d(()=>[F(m(a.key)+"："+m(a.value),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:2},1024)],64))),128)),(o(!0),r(c,null,v(e.examData.multipleChoicesList,(t,n)=>(o(),r(c,{key:e.examData.singleChoiceList.length+n},[s(i,{title:`(多选) ${e.examData.singleChoiceList.length+n+1}: ${t.content}`},null,8,["title"]),s(i,null,{default:d(()=>[s(b,{modelValue:e.form[t.id],"onUpdate:modelValue":a=>e.form[t.id]=a,shape:"square"},{default:d(()=>[(o(!0),r(c,null,v(t.questionOptions,(a,C)=>(o(),L(B,{key:C,class:"mb-2",name:a.key},{default:d(()=>[F(m(a.key)+"："+m(a.value),1)]),_:2},1032,["name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64))),128)),(o(!0),r(c,null,v(e.examData.judgmentList,(t,n)=>(o(),r(c,{key:e.examData.singleChoiceList.length+e.examData.multipleChoicesList.length+n},[s(i,{title:`(判断) ${e.examData.singleChoiceList.length+e.examData.multipleChoicesList.length+n+1}: ${t.content}`},null,8,["title"]),s(i,null,{default:d(()=>[(o(!0),r(c,null,v(t.questionOptions,(a,C)=>(o(),L(y,{key:C,modelValue:e.form[t.id],"onUpdate:modelValue":V=>e.form[t.id]=V,class:"mb-2"},{default:d(()=>[s(_,{name:a.key},{default:d(()=>[F(m(a.key)+"："+m(a.value),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:2},1024)],64))),128))]),_:1},8,["model"]),s(k,{type:"primary",class:"w-full",round:"",text:"提交考试",onClick:e.submit},null,8,["onClick"])],64))])}const ye=M(le,[["render",me],["__scopeId","data-v-a6499148"]]);export{ye as default};
