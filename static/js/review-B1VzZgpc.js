import{j as fe,d as S,ag as pe,ah as he,r as v,k as U,ai as ge,aj as ye,b as u,O as te,a5 as oe,ak as we,K as _e,al as be,am as Be,an as se,ao as ae,ap as Ce,l as ke,aq as Ee,h as y,ar as ne,_ as z,o as f,c as _,w,g as R,f as $,F as I,q as N,e as q,a as l,t as C,B as A,a3 as H,y as le,L as ue,as as $e,at as Le,E as Re,au as Ve,av as De,af as Fe}from"./index-Dvvcmwih.js";import{F as M}from"./index-CN8sgSFz.js";import{D as ie}from"./index-D9IzokZd.js";const[Ie,F]=fe("rate");function Ne(e,t,c,p){return e>=t?{status:"full",value:1}:e+.5>=t&&c&&!p?{status:"half",value:.5}:e+1>=t&&c&&p?{status:"half",value:Math.round((e-t+1)*1e10)/1e10}:{status:"void",value:0}}const qe={size:te,icon:oe("star"),color:String,count:we(5),gutter:te,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:oe("star-o"),allowHalf:Boolean,voidColor:String,touchable:_e,iconPrefix:String,modelValue:be(0),disabledColor:String};var Se=S({name:Ie,props:qe,emits:["change","update:modelValue"],setup(e,{emit:t}){const c=pe(),[p,g]=he(),i=v(),r=U(()=>e.readonly||e.disabled),h=U(()=>r.value||!e.touchable),b=U(()=>Array(+e.count).fill("").map((d,n)=>Ne(e.modelValue,n+1,e.allowHalf,e.readonly)));let s,B,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;const E=()=>{B=ae(i);const d=p.value.map(ae);s=[],d.forEach((n,m)=>{a=Math.min(n.top,a),o=Math.max(n.top,o),e.allowHalf?s.push({score:m+.5,left:n.left,top:n.top,height:n.height},{score:m+1,left:n.left+n.width/2,top:n.top,height:n.height}):s.push({score:m+1,left:n.left,top:n.top,height:n.height})})},k=(d,n)=>{for(let m=s.length-1;m>0;m--)if(n>=B.top&&n<=B.bottom){if(d>s[m].left&&n>=s[m].top&&n<=s[m].top+s[m].height)return s[m].score}else{const V=n<B.top?a:o;if(d>s[m].left&&s[m].top===V)return s[m].score}return e.allowHalf?.5:1},j=d=>{r.value||d===e.modelValue||(t("update:modelValue",d),t("change",d))},re=d=>{h.value||(c.start(d),E())},de=d=>{if(!h.value&&(c.move(d),c.isHorizontal()&&!c.isTap.value)){const{clientX:n,clientY:m}=d.touches[0];Be(d),j(k(n,m))}},ce=(d,n)=>{const{icon:m,size:V,color:O,count:X,gutter:G,voidIcon:Y,disabled:L,voidColor:K,allowHalf:J,iconPrefix:W,disabledColor:Z}=e,P=n+1,T=d.status==="full",D=d.status==="void",ve=J&&d.value>0&&d.value<1;let x;G&&P!==+X&&(x={paddingRight:Ce(G)});const me=ee=>{E();let Q=J?k(ee.clientX,ee.clientY):P;e.clearable&&c.isTap.value&&Q===e.modelValue&&(Q=0),j(Q)};return u("div",{key:n,ref:g(n),role:"radio",style:x,class:F("item"),tabindex:L?void 0:0,"aria-setsize":X,"aria-posinset":P,"aria-checked":!D,onClick:me},[u(se,{size:V,name:T?m:Y,class:F("icon",{disabled:L,full:T}),color:L?Z:T?O:K,classPrefix:W},null),ve&&u(se,{size:V,style:{width:d.value+"em"},name:D?Y:m,class:F("icon",["half",{disabled:L,full:!D}]),color:L?Z:D?K:O,classPrefix:W},null)])};return ge(()=>e.modelValue),ye("touchmove",de,{target:i}),()=>u("div",{ref:i,role:"radiogroup",class:F({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:re},[b.value.map(ce)])}});const Pe=ke(Se),Te=S({name:"QuestionAnswer",props:{course:{type:Object,required:!0}},setup(e){const t=v(!1),c=v(!1),p=v([]),g=v(!1),i=v(""),r=v(!1),h=v(""),b=v(null),s=async()=>{t.value=!0;try{const k=await Ee({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,p.value=[...k.records]}catch{y("加载失败")}finally{t.value=!1}};return{loading:t,finished:c,qaList:p,showReplyDialog:g,replyContent:i,showQuestionDialog:r,questionContent:h,onLoad:s,reply:k=>{b.value=k,g.value=!0},submitReply:async()=>{if(!i.value.trim()){y("回复内容不能为空");return}if(i.value.trim().length>200){y("回复内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"answer",content:i.value,pid:b.value}),y("回复成功"),g.value=!1,i.value="",s()}catch{y("回复失败")}},question:()=>{r.value=!0},submitQuestion:async()=>{if(!h.value.trim()){y("提问内容不能为空");return}if(h.value.trim().length>200){y("提问内容不能超过200个字符");return}try{await ne({courseId:e.course.id,type:"question",content:h.value}),y("提问成功"),r.value=!1,h.value="",s()}catch{y("提问失败")}}}}}),Qe={class:"question-answer"},Ue={key:0,class:"mb-4"},ze={key:0,class:"text-center text-gray-500 py-4"},Ae={class:"line-clamp-3"},He={class:"text-gray-500"},Me={key:0,class:"answers"},je={class:"reply-user"},Oe={class:"reply-content line-clamp-2"};function Xe(e,t,c,p,g,i){const r=A,h=H,b=le,s=ue,B=M,a=ie;return f(),_("div",Qe,[e.course.hasStudy?(f(),_("div",Ue,[u(r,{type:"primary",onClick:t[0]||(t[0]=o=>e.question())},{default:w(()=>t[6]||(t[6]=[R("我要提问")])),_:1})])):$("",!0),u(s,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=o=>e.loading=o),finished:e.finished,onLoad:e.onLoad},{default:w(()=>[e.qaList.length?$("",!0):(f(),_("div",ze," 暂无内容 ")),(f(!0),_(I,null,N(e.qaList,o=>(f(),q(b,{key:o.id},{icon:w(()=>[u(h,{class:"mr-2",src:o.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:w(()=>[l("div",null,C(o.userName),1),l("div",Ae,C(o.content),1),l("div",He,C(o.createTime),1),o.answers&&o.answers.length?(f(),_("div",Me,[t[7]||(t[7]=l("h3",{class:"font-semibold"},"回答 /",-1)),(f(!0),_(I,null,N(o.answers,E=>(f(),_("div",{key:E.id,class:"reply-item text-sm"},[l("div",je,C(E.userName)+"：",1),l("div",Oe,C(E.content),1)]))),128))])):$("",!0)]),"right-icon":w(()=>[e.course.hasStudy?(f(),q(r,{key:0,type:"primary",size:"small",onClick:E=>e.reply(o.id)},{default:w(()=>t[8]||(t[8]=[R("回复")])),_:2},1032,["onClick"])):$("",!0)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),u(a,{show:e.showQuestionDialog,"onUpdate:show":t[3]||(t[3]=o=>e.showQuestionDialog=o),title:"提问","show-cancel-button":"",onConfirm:e.submitQuestion},{default:w(()=>[u(B,{modelValue:e.questionContent,"onUpdate:modelValue":t[2]||(t[2]=o=>e.questionContent=o),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"]),u(a,{show:e.showReplyDialog,"onUpdate:show":t[5]||(t[5]=o=>e.showReplyDialog=o),title:"回复","show-cancel-button":"",onConfirm:e.submitReply},{default:w(()=>[u(B,{modelValue:e.replyContent,"onUpdate:modelValue":t[4]||(t[4]=o=>e.replyContent=o),placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const wt=z(Te,[["render",Xe],["__scopeId","data-v-8a06478b"]]),Ge=S({name:"NoteList",props:{course:{type:Object,required:!0}},setup(e){const t=v(!1),c=v(!1),p=v([]),g=v(!1),i=v(""),r=async()=>{t.value=!0;try{const s=await $e({courseId:e.course.id,page:{current:1,size:-1}});c.value=!0,p.value=[...s.records]}catch{y("加载失败")}finally{t.value=!1}};return{loading:t,finished:c,noteList:p,showDialog:g,content:i,onLoad:r,question:()=>{g.value=!0},submitQuestion:async()=>{if(!i.value.trim()){y("笔记内容不能为空");return}if(i.value.trim().length>200){y("笔记内容不能超过200个字符");return}try{await Le({courseId:e.course.id,content:i.value}),y("提交成功"),g.value=!1,i.value="",r()}catch{y("提交失败")}}}}}),Ye={class:"question-answer"},Ke={key:0,class:"mb-4"},Je={key:0,class:"text-center text-gray-500 py-4"},We={class:"line-clamp-3"},Ze={class:"text-gray-500"};function xe(e,t,c,p,g,i){const r=A,h=H,b=le,s=ue,B=M,a=ie;return f(),_("div",Ye,[e.course.hasStudy?(f(),_("div",Ke,[u(r,{type:"primary",onClick:t[0]||(t[0]=o=>e.question())},{default:w(()=>t[4]||(t[4]=[R("添加笔记")])),_:1})])):$("",!0),u(s,{loading:e.loading,"onUpdate:loading":t[1]||(t[1]=o=>e.loading=o),finished:e.finished,onLoad:e.onLoad},{default:w(()=>[e.noteList.length?$("",!0):(f(),_("div",Je," 暂无内容 ")),(f(!0),_(I,null,N(e.noteList,o=>(f(),q(b,{key:o.id},{icon:w(()=>[u(h,{class:"mr-2",src:o.userAvatar,width:"32",height:"32",round:""},null,8,["src"])]),title:w(()=>[l("div",null,C(o.userName),1),l("div",We,C(o.content),1),l("div",Ze,C(o.createTime),1)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"]),u(a,{show:e.showDialog,"onUpdate:show":t[3]||(t[3]=o=>e.showDialog=o),title:"笔记","show-cancel-button":"",onConfirm:e.submitQuestion},{default:w(()=>[u(B,{modelValue:e.content,"onUpdate:modelValue":t[2]||(t[2]=o=>e.content=o),placeholder:"请输入问题内容"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}const _t=z(Ge,[["render",xe],["__scopeId","data-v-a808f0cc"]]),et=S({name:"ReviewList",props:{course:{type:Object,required:!0}},setup(e){const t=v(!1),c=v(0),p=v(0),g=v(!1),i=v(""),r=v([]),h=()=>{t.value=!0},b=async()=>{const a=await Ve({courseId:e.course.id,page:{current:1,size:-1}});r.value=a.page.records,c.value=a.score,g.value=a.userEvaluated},s=()=>{if(!i.value||p.value===0){y("请填写内容并评分");return}De({courseId:e.course.id,score:p.value*2,content:i.value}).then(()=>{t.value=!1,p.value=0,y("评价提交成功"),b()})},B=a=>a/2;return Re(async()=>{b()}),{showPopup:t,score:p,content:i,reviews:r,totalScore:c,userEvaluated:g,showReviewPopup:h,submitReview:s,getHalf:B}}}),tt={class:"review-page"},ot={class:"total-score bg-white p-4"},st={class:"mr-2"},at={class:"review-popup"},nt={class:"score-section mb-2"},lt={class:"content-section mb-2 flex"},ut={class:"flex justify-end"},it={class:"review-list"},rt={key:0,class:"text-center text-gray-500 py-4"},dt={class:"review-content"},ct={class:"review-header"},vt={class:"name"},mt={class:"review-body"},ft={class:"review-footer"};function pt(e,t,c,p,g,i){const r=Pe,h=A,b=M,s=Fe,B=H;return f(),_("div",tt,[l("div",ot,[t[3]||(t[3]=l("span",null,"综合评分: ",-1)),l("span",st,C(e.totalScore),1),u(r,{"model-value":e.getHalf(e.totalScore),"allow-half":"",readonly:""},null,8,["model-value"])]),e.course.hasStudy&&!e.userEvaluated?(f(),q(h,{key:0,type:"primary",onClick:e.showReviewPopup},{default:w(()=>t[4]||(t[4]=[R("我要评价")])),_:1},8,["onClick"])):$("",!0),u(s,{show:e.showPopup,"onUpdate:show":t[2]||(t[2]=a=>e.showPopup=a),position:"bottom",style:{"background-color":"var(--van-gray-1)"}},{default:w(()=>[l("div",at,[l("div",nt,[t[5]||(t[5]=l("span",{class:"mr-4"},"分数",-1)),u(r,{modelValue:e.score,"onUpdate:modelValue":t[0]||(t[0]=a=>e.score=a),"allow-half":""},null,8,["modelValue"])]),l("div",lt,[t[6]||(t[6]=l("span",{class:"mr-4"},"内容",-1)),u(b,{modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=a=>e.content=a),class:"flex-1",type:"textarea",rows:"3",autosize:"",clearable:"",maxlength:"200",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),l("div",ut,[u(h,{type:"primary",onClick:e.submitReview},{default:w(()=>t[7]||(t[7]=[R("提交")])),_:1},8,["onClick"])])])]),_:1},8,["show"]),l("div",it,[e.reviews.length?$("",!0):(f(),_("div",rt," 暂无内容 ")),(f(!0),_(I,null,N(e.reviews,a=>(f(),_("div",{key:a.id,class:"review-item bg-white p-4"},[u(B,{src:a.userAvatar,class:"avatar",round:""},null,8,["src"]),l("div",dt,[l("div",ct,[l("span",vt,C(a.userName),1),u(r,{"model-value":e.getHalf(a.score),"allow-half":"",readonly:""},null,8,["model-value"])]),l("div",mt,C(a.content),1),l("div",ft,C(a.createTime),1)])]))),128))])])}const bt=z(et,[["render",pt],["__scopeId","data-v-3b2c18cd"]]);export{_t as N,wt as Q,bt as R};
