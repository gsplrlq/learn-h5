import{d as R,Z as T,E as O,r as D,G as U,aA as F,aB as I,aC as P,aD as B,h as j,_ as G,c as n,o,a as p,t as c,F as m,b as l,w as d,q as v,y as N,e as $,g as x,B as z,aE as A}from"./index-2WoK3mnG.js";import{C as M,a as S}from"./index-BcIJrlMK.js";import{R as Z,a as q}from"./index-BYk1u5Fr.js";import{s as E,a as H}from"./function-call-D11ebchD.js";import{F as J}from"./index-CbGVjTWc.js";import"./Dialog-Cne7LoH-.js";import"./index-C0YfNoN3.js";const K=R({name:"Exam",setup(){const a=T(),_=O(),u=D({}),r=D({}),f=D(0);let h=null;const i=D(null),C=async()=>{try{const t=await I(a.params.id);t.multipleChoicesList.forEach(s=>{r.value[s.id]=[]}),u.value=t,u.value.duration>0&&(f.value=u.value.duration*60,g()),u.value.hasEvaluation||(P({courseId:u.value.courseId}),E({message:"请进行满意度测评！",showCancelButton:!1,confirmButtonText:"去测评"}).then(()=>{_.push(`/exam/evaluation/${u.value.courseId}`)}))}catch{u.value={}}},g=()=>{h=window.setTimeout(()=>{f.value-=1,f.value===0?(V(),clearTimeout(h)):g()},1e3)},V=async()=>{const t=Object.keys(r.value).map(e=>({questionId:e,userOptions:typeof r.value[e]=="string"?[r.value[e]]:r.value[e]})),s={examId:u.value.id,trainingPackageId:a.query.trainingPackageId,questionReqList:t};try{const e=await B(s);E({message:"考试时间已结束, 请退出本次考试。（并自动交卷）"}).then(()=>{i.value=e})}catch(e){console.error(e)}},b=()=>{H({title:"提示",message:"确定提交本次考试，无法撤回，是否继续？"}).then(async()=>{const t=Object.keys(r.value).map(e=>({questionId:e,userOptions:typeof r.value[e]=="string"?[r.value[e]]:r.value[e]})),s={examId:u.value.id,trainingPackageId:a.query.trainingPackageId,questionReqList:t};try{const e=await B(s);i.value=e,j("提交成功!"),clearTimeout(h)}catch(e){console.error(e)}})},L=()=>{_.go(-1)},k=()=>{_.replace({path:`/exam/detail/${i.value.id}`})};return U(()=>{C()}),F(()=>{clearTimeout(h)}),{examData:u,form:r,durationTime:f,result:i,submit:b,exit:L,toDetail:k}}}),Q={class:"exam"},W={class:"name"},X={class:"time"},Y={class:"scores"},ee={class:"flex"},ae={class:"mr-4"};function te(a,_,u,r,f,h){const i=N,C=q,g=Z,V=S,b=M,L=J,k=z;return o(),n("div",Q,[p("div",W,c(a.examData.name),1),p("div",X,c(a.examData.duration)+"分钟",1),a.result?(o(),n(m,{key:1},[p("div",Y,c(a.result.scores),1),p("div",{class:A(["result",a.result.examResult])},c(a.result.examResult==="qualified"?"合格":"不合格"),3),p("div",ee,[p("div",ae,[l(k,{type:"primary",text:"查看考试详情",onClick:a.toDetail},null,8,["onClick"])]),l(k,{type:"danger",text:"退出考试",onClick:a.exit},null,8,["onClick"])])],64)):(o(),n(m,{key:0},[l(L,{class:"list","label-position":"top",model:a.form},{default:d(()=>[(o(!0),n(m,null,v(a.examData.singleChoiceList,(t,s)=>(o(),n(m,{key:s},[l(i,{title:`(单选) ${s+1}: ${t.content}`},null,8,["title"]),l(i,null,{default:d(()=>[(o(!0),n(m,null,v(t.questionOptions,(e,y)=>(o(),$(g,{key:y,modelValue:a.form[t.id],"onUpdate:modelValue":w=>a.form[t.id]=w,class:"mb-2"},{default:d(()=>[l(C,{name:e.key},{default:d(()=>[x(c(e.key)+"："+c(e.value),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:2},1024)],64))),128)),(o(!0),n(m,null,v(a.examData.multipleChoicesList,(t,s)=>(o(),n(m,{key:a.examData.singleChoiceList.length+s},[l(i,{title:`(多选) ${a.examData.singleChoiceList.length+s+1}: ${t.content}`},null,8,["title"]),l(i,null,{default:d(()=>[l(b,{modelValue:a.form[t.id],"onUpdate:modelValue":e=>a.form[t.id]=e,shape:"square"},{default:d(()=>[(o(!0),n(m,null,v(t.questionOptions,(e,y)=>(o(),$(V,{key:y,class:"mb-2",name:e.key},{default:d(()=>[x(c(e.key)+"："+c(e.value),1)]),_:2},1032,["name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64))),128)),(o(!0),n(m,null,v(a.examData.judgmentList,(t,s)=>(o(),n(m,{key:a.examData.singleChoiceList.length+a.examData.multipleChoicesList.length+s},[l(i,{title:`(判断) ${a.examData.singleChoiceList.length+a.examData.multipleChoicesList.length+s+1}: ${t.content}`},null,8,["title"]),l(i,null,{default:d(()=>[(o(!0),n(m,null,v(t.questionOptions,(e,y)=>(o(),$(g,{key:y,modelValue:a.form[t.id],"onUpdate:modelValue":w=>a.form[t.id]=w,class:"mb-2"},{default:d(()=>[l(C,{name:e.key},{default:d(()=>[x(c(e.key)+"："+c(e.value),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:2},1024)],64))),128))]),_:1},8,["model"]),l(k,{type:"primary",class:"w-full",round:"",text:"提交考试",onClick:a.submit},null,8,["onClick"])],64))])}const me=G(K,[["render",te],["__scopeId","data-v-661265ae"]]);export{me as default};
