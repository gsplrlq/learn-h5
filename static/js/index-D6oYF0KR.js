import{d as x,Z as R,G as T,r as D,E as A,aA as O,aB as U,aC as I,aD as F,h as P,_ as j,c as n,a as p,t as c,F as m,b as l,w as d,aE as G,B as N,o,q as v,e as L,g as w,y as z}from"./index-2UieMHSs.js";import{C as M,a as S}from"./index-DZ5KQYpg.js";import{R as Z,a as q}from"./index-DjKxitHR.js";import{s as $,a as H}from"./function-call-BU2y051l.js";import{F as J}from"./index-Du_ITMuI.js";import"./Dialog-Dfmh1vnV.js";import"./index-BXQWHmAS.js";const K=x({name:"Exam",setup(){const a=R(),_=T(),u=D({}),r=D({}),f=D(0);let h=null;const i=D(null),C=async()=>{try{const t=await U(a.params.id);t.multipleChoicesList.forEach(s=>{r.value[s.id]=[]}),u.value=t,u.value.duration>0&&(f.value=u.value.duration*60,g()),u.value.hasEvaluation||(I({courseId:u.value.courseId}),$({message:"请进行满意度测评！",showCancelButton:!1,confirmButtonText:"去测评"}).then(()=>{_.push(`/exam/evaluation/${u.value.courseId}`)}))}catch{u.value={}}},g=()=>{h=window.setTimeout(()=>{f.value-=1,f.value===0?(B(),clearTimeout(h)):g()},1e3)},B=async()=>{const t=Object.keys(r.value).map(e=>({questionId:e,userOptions:typeof r.value[e]=="string"?[r.value[e]]:r.value[e]})),s={examId:u.value.id,trainingPackageId:a.query.trainingPackageId,questionReqList:t};try{const e=await F(s);$({message:"考试时间已结束, 请退出本次考试。（并自动交卷）"}).then(()=>{i.value=e})}catch(e){console.error(e)}},V=()=>{H({title:"提示",message:"确定提交本次考试，无法撤回，是否继续？"}).then(async()=>{const t=Object.keys(r.value).map(e=>({questionId:e,userOptions:typeof r.value[e]=="string"?[r.value[e]]:r.value[e]})),s={examId:u.value.id,trainingPackageId:a.query.trainingPackageId,questionReqList:t};try{const e=await F(s);i.value=e,P("提交成功!"),clearTimeout(h)}catch(e){console.error(e)}})},b=()=>{_.go(-1)},k=()=>{_.replace({path:`/exam/detail/${i.value.id}`})};return A(()=>{C()}),O(()=>{clearTimeout(h)}),{examData:u,form:r,durationTime:f,result:i,submit:V,exit:b,toDetail:k}}}),Q={class:"exam"},W={class:"name"},X={class:"time"},Y={class:"scores"},ee={class:"flex"},ae={class:"mr-4"};function te(a,_,u,r,f,h){const i=z,C=Z,g=q,B=M,V=S,b=J,k=N;return o(),n("div",Q,[p("div",W,c(a.examData.name),1),p("div",X,c(a.examData.duration)+"分钟",1),a.result?(o(),n(m,{key:1},[p("div",Y,c(a.result.scores),1),p("div",{class:G(["result",a.result.examResult])},c(a.result.examResult==="qualified"?"合格":"不合格"),3),p("div",ee,[p("div",ae,[l(k,{type:"primary",text:"查看考试详情",onClick:a.toDetail},null,8,["onClick"])]),l(k,{type:"danger",text:"退出考试",onClick:a.exit},null,8,["onClick"])])],64)):(o(),n(m,{key:0},[l(b,{class:"list","label-position":"top",model:a.form},{default:d(()=>[(o(!0),n(m,null,v(a.examData.singleChoiceList,(t,s)=>(o(),n(m,{key:s},[l(i,{title:`(单选) ${s+1}: ${t.content}`},null,8,["title"]),l(i,null,{default:d(()=>[(o(!0),n(m,null,v(t.questionOptions,(e,y)=>(o(),L(g,{key:y,modelValue:a.form[t.id],"onUpdate:modelValue":E=>a.form[t.id]=E,class:"mb-2"},{default:d(()=>[l(C,{name:e.key},{default:d(()=>[w(c(e.key)+"："+c(e.value),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:2},1024)],64))),128)),(o(!0),n(m,null,v(a.examData.multipleChoicesList,(t,s)=>(o(),n(m,{key:a.examData.singleChoiceList.length+s},[l(i,{title:`(多选) ${a.examData.singleChoiceList.length+s+1}: ${t.content}`},null,8,["title"]),l(i,null,{default:d(()=>[l(V,{modelValue:a.form[t.id],"onUpdate:modelValue":e=>a.form[t.id]=e,shape:"square"},{default:d(()=>[(o(!0),n(m,null,v(t.questionOptions,(e,y)=>(o(),L(B,{key:y,class:"mb-2",name:e.key},{default:d(()=>[w(c(e.key)+"："+c(e.value),1)]),_:2},1032,["name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64))),128)),(o(!0),n(m,null,v(a.examData.judgmentList,(t,s)=>(o(),n(m,{key:a.examData.singleChoiceList.length+a.examData.multipleChoicesList.length+s},[l(i,{title:`(判断) ${a.examData.singleChoiceList.length+a.examData.multipleChoicesList.length+s+1}: ${t.content}`},null,8,["title"]),l(i,null,{default:d(()=>[(o(!0),n(m,null,v(t.questionOptions,(e,y)=>(o(),L(g,{key:y,modelValue:a.form[t.id],"onUpdate:modelValue":E=>a.form[t.id]=E,class:"mb-2"},{default:d(()=>[l(C,{name:e.key},{default:d(()=>[w(c(e.key)+"："+c(e.value),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:2},1024)],64))),128))]),_:1},8,["model"]),l(k,{type:"primary",class:"w-full",round:"",text:"提交考试",onClick:a.submit},null,8,["onClick"])],64))])}const me=j(K,[["render",te],["__scopeId","data-v-661265ae"]]);export{me as default};
